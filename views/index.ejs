<% layout("layout") %>

<div class="row mb-4">
    <div class="col-md-3 mb-3">
        <div class="card text-center dashboard-card">
            <div class="card-header">ğŸ›’ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</div>
            <div class="card-body">
                <h5 class="card-title"></h5>
                <p class="card-text">JOD <%= stats.totalPurchases %></p>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="card text-center dashboard-card">
            <div class="card-header">ğŸ’° Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</div>
            <div class="card-body">
                <h5 class="card-title"></h5>
                <p class="card-text">JOD <%= stats.totalSales %></p>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="card text-center dashboard-card">
            <div class="card-header">ğŸ“ˆ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</div>
            <div class="card-body">
                <h5 class="card-title"></h5>
                <p class="card-text">JOD <%= stats.profit %></p>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="card text-center dashboard-card">
            <div class="card-header">ğŸ“‹ Ø·Ù„Ø¨Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±</div>
            <div class="card-body">
                <h5 class="card-title"></h5>
                <p class="card-text"><%= stats.pendingPrep %></p>
            </div>
        </div>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-6 mb-3">
        <div class="card">
            <div class="card-header">ğŸ“Š ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</div>
            <div class="card-body">
                <canvas id="stockChart"></canvas>
            </div>
        </div>
    </div>
    <div class="col-md-6 mb-3">
        <div class="card">
            <div class="card-header">ğŸ”” Ø¢Ø®Ø± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</div>
            <div class="card-body">
                <ul class="list-group list-group-flush">
                    <% if (stats.recentSales.length > 0) { %>
                        <% stats.recentSales.forEach(sale => { %>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span><%= sale.product %> - <%= sale.customerName %></span>
                                <span class="badge bg-primary rounded-pill">JOD <%= (sale.quantity * sale.price).toFixed(2) %></span>
                            </li>
                        <% }); %>
                    <% } else { %>
                        <li class="list-group-item text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨ÙŠØ¹Ø§Øª Ø­Ø¯ÙŠØ«Ø© Ù„Ø¹Ø±Ø¶Ù‡Ø§.</li>
                    <% } %>
                </ul>
            </div>
        </div>
    </div>
</div>

<h2 class="dashboard-section-title">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù…</h2>
<div class="row mb-4">
    <div class="col-md-2 col-sm-4 col-6 mb-3">
        <a href="/purchases" class="btn btn-primary w-100 py-3 d-flex flex-column align-items-center justify-content-center">
            <span class="icon mb-2">ğŸ›’</span>
            <span>Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</span>
        </a>
    </div>
    <div class="col-md-2 col-sm-4 col-6 mb-3">
        <a href="/sales" class="btn btn-primary w-100 py-3 d-flex flex-column align-items-center justify-content-center">
            <span class="icon mb-2">ğŸ’°</span>
            <span>Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</span>
        </a>
    </div>
    <div class="col-md-2 col-sm-4 col-6 mb-3">
        <a href="/stock" class="btn btn-primary w-100 py-3 d-flex flex-column align-items-center justify-content-center">
            <span class="icon mb-2">ğŸ“¦</span>
            <span>Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</span>
        </a>
    </div>
    <div class="col-md-2 col-sm-4 col-6 mb-3">
        <a href="/prep" class="btn btn-primary w-100 py-3 d-flex flex-column align-items-center justify-content-center">
            <span class="icon mb-2">ğŸ“‹</span>
            <span>Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ­Ø¶ÙŠØ±</span>
        </a>
    </div>
    <div class="col-md-2 col-sm-4 col-6 mb-3">
        <a href="/digital-cards" class="btn btn-primary w-100 py-3 d-flex flex-column align-items-center justify-content-center">
            <span class="icon mb-2">ğŸ“‡</span>
            <span>Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø±Ù‚Ù…ÙŠØ©</span>
        </a>
    </div>
    <% if (user.role === 'admin') { %>
    <div class="col-md-2 col-sm-4 col-6 mb-3">
        <a href="/users" class="btn btn-primary w-100 py-3 d-flex flex-column align-items-center justify-content-center">
            <span class="icon mb-2">ğŸ‘¥</span>
            <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</span>
        </a>
    </div>
    <div class="col-md-2 col-sm-4 col-6 mb-3">
        <a href="/settings" class="btn btn-primary w-100 py-3 d-flex flex-column align-items-center justify-content-center">
            <span class="icon mb-2">âš™ï¸</span>
            <span>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
        </a>
    </div>
    <% } %>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    fetch("/api/chart-data")
        .then(res => res.json())
        .then(data => {
            const ctx = document.getElementById("stockChart").getContext("2d");
            new Chart(ctx, {
                type: "doughnut",
                data: {
                    labels: data.stockLabels,
                    datasets: [{
                        data: data.stockValues,
                        backgroundColor: ["#007bff", "#28a745", "#ffc107", "#dc3545", "#6c757d"],
                        borderWidth: 1
                    }]
                },
                options: { 
                    responsive: true, 
                    plugins: { 
                        legend: { 
                            position: "bottom" 
                        }
                    }
                }
            });
        });

    if ("serviceWorker" in navigator) {
        navigator.serviceWorker.register("/assets/service-worker.js");
    }
</script>
